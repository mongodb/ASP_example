{
  "name": "changestream_basic",
  "pipeline": [
    {
      "$source": {
        "connectionName": "sample_stream_solar"
      }
    },
    {
      "$tumblingWindow": {
        "interval": { "size": 10, "unit": "second" },
        "pipeline": [
          {
            "$group": {
              "_id": "$device_id",
              "msgs": { "$sum": 1 }
            }
          }
        ]
      }
    },
    {
      "$merge": {
        "into": {
          "connectionName": "sample_streaming",
          "db": "sample_streaming",
          "coll": "solar_rollup"
        },
        "on": "_id",
        "whenMatched": "replace",
        "whenNotMatched": "insert"
      }
    }
  ]
}
